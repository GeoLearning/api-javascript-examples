<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="GeoLearning Catalog Gadget" 
    title_url="http://www.geolearning.com" 
    scrolling="true">
  </ModulePrefs>
  <UserPref name="show_date" display_name="Show Dates?" datatype="bool" default_value="false"/>
  <UserPref name="num_entries" display_name="Number of Entries:" default_value="5"/>
  <UserPref name="show_summ" display_name="Show Summaries?" datatype="bool" default_value="false"/>
  <Content type="html">
  <![CDATA[
  <style> #content_div { font-size: 80%;  margin: 5px; } </style>
  <div id="content_div"></div>
  <script type="text/javascript">

  // Get userprefs
  var prefs = new gadgets.Prefs();
  var showdate = prefs.getBool("show_date");
  var entries = prefs.getInt("num_entries");
  var summaries = prefs.getBool("show_summ");

  function getFeed() {  
    var params = {};  
    params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.JSON;  
    var url = "http://pubservices.geolearning.com/api/geoproductmanagement/open/catalog?format=JSON";  
    gadgets.io.makeRequest(url, response, params);
  };

  function response(obj) { 
    // obj.data contains the feed data
    alert(obj.data.feed);
    var feed = obj.data.feed;
    var html = "";

    // Display the feed title and description
    html += "<div><b>" + feed.title + "</b></div>";
    html += "<div>A list of available learning resources from GeoLearning</div><br>";
      
    // Access the data for a given entry
    if (feed.entry) {
      for (var i = 0; i < feed.entry.length; i++) {
        var link = feed.entry[i].link[0]["@href"];
        
        html += "<div>"
          + "<a target='_blank' href='" + link + "'>"
          + feed.entry[i].title
          + "</a> ";
          
        if (showdate==true)
        { 
          html += "<br><i>" + feed.entry[i]["geo:LastModifiedDisplay"] + "</i>";
        }
        if (summaries==true) { 
          html += "<br><i>" + feed.entry[i].summary + "</i>";
        }
        html += "</div>";
      }
    }        
    document.getElementById('content_div').innerHTML = html;
  };
  gadgets.util.registerOnLoadHandler(getFeed);
  </script>
  ]]>
  </Content>
</Module>